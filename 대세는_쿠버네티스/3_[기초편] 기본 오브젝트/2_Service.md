# Service - ClusterIP, NodePort, LoadBalancer

파드의 경우 시스템/서비스 장애로 인해 언제든 종료되어 새롭게 생성될 수 있고, 이 때마다 할당된 IP가 변경된다.  
이와 달리 서비스는 임의로 삭제하지 않는 한 한 번 생성되면 그대로 유지된다.  
따라서 파드에 요청을 보낼 때에는 해당 파드에 연결한 서비스를 통하는 게 일반적이다.

이 때 서비스는 크게 세가지 종류로 구분할 수 있다 - **ClusterIP, NodePort, LoadBalancer**

## ClusterIP

ClusterIP의 경우 특정 클러스터 내에서 해당 서비스에 접근할 수 있는 IP를 하나 할당받게 된다.  
해당 IP를 통해 외부에서 접근하는 것은 불가능하고, 클러스터 내에서만 접근이 가능하다.  
ClusterIP는 보통 어드민 사용자가 직접 클러스터에 접속해서 사용하는 경우에 채택된다.

## NodePort

NodePort의 경우 모든 노드의 특정 포트를 할당 받아서 서비스에 연결시키는 방식이다.  
이 경우 모든 노드에서는 해당 포트로 요청이 오면 연결된 서비스로 전달한다.  
이 때 서비스에서는 요청이 온 노드와 무관하게 자신에게 연결된 파드에 요청을 전달하게 된다.

따라서 처음 요청을 받은 노드와 최종적으로 요청을 전달 받는 파드의 노드가 다를 수 있다.  
만약 이를 일치시키고 싶다면 externalTrafficPolicy: Local 옵션을 줄 수 있다.

NodePort은 보통 내부망 또는 임시적으로 연결하는 용도로 많이 사용하는 서비스 유형이다.

## LoadBalancer

LoadBalancer의 경우 NodePort의 구조에 더해서, 트래픽을 각 노드에 분산시키는 Load Balancer를 추가적으로 생성한다.  
이 때에는 Load Balancer에 할당된 IP를 통해 외부에서 접근하는 것이 가능하다.  
이 때 외부 IP가 자동으로 생성되지는 않기 때문에, 이를 지원하는 플러그인이 설치되어 있어야 한다.

LoadBalancer 타입은 보통 실제로 서비스를 외부에 노출할 때 사용하는 방식이다.
