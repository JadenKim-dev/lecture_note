### 체크 예외와 인터페이스

이번에는 기존의 로직에서 다음 두 가지를 변경할 것이다.

- 체크 예외를 런타임 예외로 감싸서 예외에 대한 의존 제거하기
- Repository의 인터페이스를 만들어서, 서비스 단에서 구현 객체가 아닌 인터페이스에 의존하도록 변경

기존에 Repository를 인터페이스화 하지 못한 이유는, 체크 예외를 던지기 위해서는 인터페이스에서도 예외를 던져야 하기 때문이다.  
인터페이스에서 던지지 않은 예외를 구현 클래스에서 던지면 컴파일 에러가 발생한다.  

```java
public interface MemberRepositoryEx {
    Member save(Member member) throws SQLException;
    Member findById(String memberId) throws SQLException;
    void update(String memberId, int money) throws SQLException;
    void delete(String memberId) throws SQLException;
}
```

그렇다고 위와 같이 인터페이스에 예외를 명시하면 인터페이스가 특정 기술에 의존하게 된다.  
이러면 구현체를 유연하게 변경할 수 없어서 인터페이스를 사용하는 의미가 없어진다.

따라서 체크 예외를 런타임 예외로 감싸서, 인터페이스에는 예외를 명시하지 않아도 되게 만들어야 한다. 

```java
public interface MemberRepository {
    Member save(Member member);
    Member findById(String memberId);
    void update(String memberId, int money);
    void delete(String memberId);
}
```

### 런타임 예외 적용

위에서 정의한 체크 예외를 던지지 않는 Repository 인터페이스를 사용한다.  
SQLException을 감싸서 사용할 RuntimeException을 다음과 같이 정의한다.  

```java
public class MyDbException extends RuntimeException {
    public MyDbException() {}
    public MyDbException(String message) {
         super(message);
    }
    public MyDbException(String message, Throwable cause) {
        super(message, cause);
    }
    public MyDbException(Throwable cause) {
        super(cause);
    } 
}
```

이제 각 메서드의 catch 문에서 다음과 같이 에러를 감싸서 던지는 식으로 구현하면 된다.

```java
catch(SQLException e) {
  throw new MyDbException(e);
}
```
이 때 이전 에러 원인을 로그로 남기기 위해 반드시 이전 에러를 감싸서 생성해야 한다

이제 Repository단의 메서드에서 체크 예외가 발생하지 않으므로, 이들을 호출하는 Service 단에서도 더이상 체크 예외를 던지지 않아도 된다.  
Service 단에서 Repository 구현체 대신 인터페이스에 의존하도록 변경하고, 각 메서드의 체크 예외 정의 부분을 제거한다.

```java
 @Slf4j
 @RequiredArgsConstructor
 public class MemberServiceV4 {
     // 인터페이스 의존
     private final MemberRepository memberRepository;
     // 체크 예외가 없어짐
     @Transactional
     public void accountTransfer(String fromId, String toId, int money) {
         bizLogic(fromId, toId, money);
     // 체크 예외가 없어짐
     private void bizLogic(String fromId, String toId, int money) {
         Member fromMember = memberRepository.findById(fromId);
         Member toMember = memberRepository.findById(toId);
         memberRepository.update(fromId, fromMember.getMoney() - money);
         validation(toMember);
         memberRepository.update(toId, toMember.getMoney() + money);
}
…
} }
```
