### 예외 계층

예외의 최상위 부모에는 Object가 있고 그 다음 Throwable의 자식인 Exception, Error가 있다.  
Error의 경우 메모리 부족 등 심각한 오류 상황이 발생한 경우이기 때문에 try-catch 하지 않고 그냥 던져야 하는 오류이다.

에러 핸들링 대상이 되는 것은 Exception과 그 하위 객체들이다.  
Exception은 기본적으로 컴파일러가 체크를 하는 체크 예외이지만(SQLException, IOException), RuntimeException에 한해서만 언체크 예외로 다룬다.

### 예외 기본 규칙

예외가 발생하면 잡아서 처리하거나, 밖으로 던지게 된다.  
잡아서 처리하면 그 이후의 로직은 정상 동작 하지만, 밖으로 던지면 예외가 계속 상위로 전파된다.

이 때 예외 처리는 지정한 예외 뿐만 아니라 그 하위의 예외까지 함께 묶어서 처리한다.  
예를 들어 Exception을 catch로 잡아서 처리하면 그 하위의 자식도 함께 잡힌다.  
또한 체크 예외로 Exception을 던지면 그 하위의 자식도 던질 수 있다.

> 만약 자바의 main 쓰레드에서 예외가 끝까지 잡히지 않고 던져지면 시스템이 종료된다.  
> 웹 어플리케이션 실행 중에는 보통 WAS 단에서 잡아서 처리한다. 

### 체크 예외 기본 이해

RuntimeException을 제외한 Exception의 모든 하위 예외들은 모두 Checked 예외이다.  
Checked 예외가 발생하는 메서드는 해당 예외를 잡아서 처리하거나 예외를 밖으로 던져야 한다.  

```java
public class CheckedTest {

    @Test
    void checked_catch() {
        Service service = new Service();
        service.callCatch();
    }

    @Test
    void checked_throw() {
        Service service = new Service();
        assertThatThrownBy(() -> service.callThrow())
                .isInstanceOf(MyCheckedException.class);
    }

    /**
     * Exception을 상속받은 예외는 체크 예외가 된다.
     */
    static class MyCheckedException extends Exception {
        public MyCheckedException(String message) {
            super(message);
        }
    }

    static class Service {
        Repository repository = new Repository();

        /**
         * 예외를 잡아서 처리하는 코드
         */
        public void callCatch() {
            try {
                repository.call();
            } catch (MyCheckedException e) {
                log.info("예외 처리, message={}", e.getMessage(), e);
            }
        }

        /**
         * 체크 예외를 밖으로 던지는 코드
         */
        public void callThrow() throws MyCheckedException {
            repository.call();
        }
    }

    static class Repository {
        public void call() throws MyCheckedException {
            throw new MyCheckedException("ex");
        }
    }
}
```

이 때 예외를 밖으로 던지기 위해서는 `callThrow() throws MyCheckedException` 형식으로 선언을 해야 한다.  
체크 예외 선언을 누락할 경우 컴파일 에러가 발생해서 빌드 전에 막히게 된다.

Checked 예외를 사용할 경우 개발자가 예외 처리를 빼먹지 않고 고려하도록 하는 장점이 있다.
다만 모든 예외를 잡거나 던지도록 처리해야 하기 때문에, 신경 쓰고 싶지 않은 예외까지 모두 처리해야 해서 번거롭다.

