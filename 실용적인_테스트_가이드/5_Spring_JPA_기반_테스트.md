### Layered Architecture와 테스트

스프링 MVC 등의 프레임워크에서는 주로 Layered Architecture를 사용하여 웹 어플리케이션을 구성한다.  
크게 Presentation Layer, Business Layer, Persistence Layer로 계층을 나누게 된다.  
이와 같이 계층을 구분하는 가장 큰 목적은, 관심사의 분리에 있다.  
역할과 책임을 중심으로 계층을 나눠서, 애플리케이션을 쉽게 유지보수할 수 있도록 하는 것이다.

이 때 각 계층에 스프링 MVC와 JPA 등의 기술들이 개입하면서, 이들이 테스트하기 어렵게 느껴질 수 있다.  
하지만 테스트의 기본 원리는 기술이 개입된다고 해도 변하지 않는다.  
테스트 불가능한 부분을 분리해내서 테스트 가능한 부분에 집중하고, 문서로써의 테스트를 깔끔하게 작성하면 된다.  
다만 테스트 대상이 Spring + JPA로 구성된 웹 어플리케이션으로 변경되었으므로, 해당 환경에서 무엇을, 어떻게 테스트해야 하는지에 대해서 추가로 확인하면 된다.

지금까지 우리는 특정 클래스, 메서드를 대상으로 하는 단위 테스트 위주로 테스트 코드를 작성해 왔다.  
하지만 이렇게 각각의 개체들을 테스트 하는 것만으로는, 이들이 함께 협력하여 동작하는 상황에서도 예상과 같이 동작할 것이라고 장담할 수 없다.

**통합 테스트**는 여러 모듈이 협력하는 기능을 통합적으로 검증하는 테스트이다.  
작은 범위의 단위 테스트를 넘어, 기능 전체를 통합적으로 검증함으로써 기능을 신뢰할 수 있게 한다.  
보통 각 모듈에 대해서 풍부하게 단위 테스트를 작성하고, 큰 기능들에 대해서 통합 테스트를 작성하는 식으로 전체 테스트가 구성된다.

### 스프링 & JPA 훑어보기

#### 1. 스프링

먼저 라이브러리와 프레임워크의 차이에 대해서 살펴보자.  
라이브러리를 사용하는 상황에서는 내가 작성한 코드가 능동적인 주체가 된다.  
내 코드에서 외부의 라이브러리를 가져와서 사용하게 된다.  
이와 달리 프레임워크는 내가 작성한 코드가 수동적인 대상이 된다.  
이미 동작하고 있는 시스템 내에 나의 코드를 삽입하여 동작하게 만드는 식으로 프로젝트를 구현한다.

스프링은 프레임워크로써 제공되기 때문에, 스프링을 사용하면 스프링이 갖춰놓은 기술과 환경을 사용하게 된다.  
스프링의 기술들은 IoC(Inversion of Control), DI(Dependency Injection), AOP(Aspect Oriented Programming) 을 기반으로 하고 있다.

IoC는 제어의 역전이라는 의미이다.  
전통적인 방식에서는 A 객체와 B 객체가 협력하는 상황이라면, A 객체 내부에서 B 객체를 생성해서 사용해야 한다.  
하지만 이 경우 A 객체와 B 객체가 강결합 되는 문제가 발생한다.  
이러한 문제가 있으므로 객체를 생성하고 관리하는 제어 권한을 객체 내부가 아닌 외부에서 가져야 한다는 것이 IoC이다.  
이를 위해 외부에서 객체를 생성하여 주입하는 의존성 주입(DI)을 사용한다.  
이를 통해 각 객체는 인터페이스에만 의존하게 되어, 객체 간의 결합도를 낮출 수 있다.

AOP는 비즈니스 로직과 무관한 코드들을 관점(Aspect)로 분리한다.  
대표적으로 트랜잭션, 로깅을 위한 세팅 작업들을 관점이라고 할 수 있다.  
이들을 각각 모아서 모듈로 만들고 분리해내서, 코드에서는 비즈니스 로직에만 집중할 수 있게 한다.

#### 2. JPA

객체 지향적인 개발 방식과 관계형 데이터베이스를 다루는 방식은 그 사이의 간극이 매우 큰 편이다.  
개발 단계에서 아무리 객체의 협력을 중심으로 잘 개발을 했더라도, 데이터를 저장할 때에는 그것을 하나하나 다시 분리해서 db의 테이블 및 칼럼에 맞춰서 저장해야 하는 문제가 있었다.  
ORM은 이 사이의 간극을 매꿔서, 객체 지향적인 개발 방식을 그대로 유지하면서도 데이터를 RDB에 저장할 수 있도록 지원해주는 기술이다.

JPA는 이러한 ORM 기술을 자바 표준으로 정의한 것이며, 그 구현체로 Hibernate를 많이 사용한다.  
JPA를 사용하면 반복적인 CRUD 쿼리 작업의 상당 부분이 자동으로 처리된다.

#### 엔티티 정의

수업에서는 Order와 Product를 다대다 관계로 구성할 것이다.  
이 때 중간 테이블로 OrderProduct를 사용하여, 일대다 + 다대일 관계로 풀어낼 것이다.
